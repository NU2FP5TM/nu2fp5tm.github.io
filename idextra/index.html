<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>身份证号码解析工具</title>
  <style>
    .invalid { color: red; }
    .valid { color: green; }
    .disbanded { color: red; }
    .unauthorized { color: blue; }
  </style>
</head>
<body>
  <h1>身份证号码解析工具</h1>

  <div>
    <h2>18位身份证号码解析</h2>
    <input type="text" id="idCard18" placeholder="请输入18位身份证号码">
    <button onclick="parse18IdCard()">解析</button>
    <div id="result18"></div>
  </div>

  <div>
    <h2>15位转18位</h2>
    <input type="text" id="idCard15" placeholder="请输入15位身份证号码">
    <select id="yearOption">
      <option value="19">19**年</option>
      <option value="20">20**年</option>
    </select>
    <button onclick="convert15To18()">转换为18位</button>
    <div id="result15"></div>
  </div>

  <div>
    <h2>18位转15位</h2>
    <input type="text" id="idCard18To15" placeholder="请输入18位身份证号码">
    <button onclick="convert18To15()">转换为15位</button>
    <div id="result18To15"></div>
  </div>

  <script>
   let regions = {};

async function loadRegionData() {
  try {
    const response = await fetch('region.json');
    regions = await response.json();
    console.log("Region data loaded:", regions);  // 检查数据加载情况
  } catch (error) {
    console.error("Error loading region data:", error);
  }
}

function getRegion(code) {
  const provinceCode = code.slice(0, 2);
  const cityCode = code.slice(0, 4);
  const districtCode = code.slice(0, 6);

  let region = '';
  let annotations = [];

  // 省级解析
  if (regions[provinceCode]) {
    const province = regions[provinceCode];
    region += `${province.name}`;

    // 市级解析
    if (province.cities[cityCode]) {
      const city = province.cities[cityCode];
      region += ` ${city.name}`;

      // 区县解析
      if (city.districts[districtCode]) {
        let districtName = city.districts[districtCode];
        
        // 检查是否为撤销区
        if (districtName.includes("[")) {
          annotations.push("<span style='color: red;'>(该地区已被撤并)</span>");
          districtName = districtName.replace(/\[|\]/g, "");  // 去掉方括号显示名称
        }

        // 检查是否为黑区
        if (districtName.includes("*")) {
          annotations.push("<span style='color: blue;'>(该地区事实存在，但属于国务院不承认的黑区)</span>");
          districtName = districtName.replace("*", "");  // 去掉星号显示名称
        }

        region += ` ${districtName}`;
      }
    }
  }

  // 如果有备注信息，将其附加到region字符串中
  return region + " " + annotations.join(" ");
}

    function parse18IdCard() {
      const idCard = document.getElementById("idCardInput").value;
      const output = document.getElementById("output");
      if (idCard.length === 18 || idCard.length === 15) {
        const region = getRegion(idCard);
        output.innerText = `签发地：${region}`;
      } else {
        output.innerText = "请输入15或18位的身份证号码";
      }
    }

    // 解析18位身份证号码
    function parse18IdCard() {
      const idCard18 = document.getElementById('idCard18').value.trim();
      const resultDiv = document.getElementById('result18');

      if (idCard18.length === 18) {
        const regionCode = idCard18.slice(0, 6);
        resultDiv.innerHTML = `签发地：${getRegion(regionCode)}<br>`;
        resultDiv.innerHTML += `出生日期：${idCard18.slice(6, 10)}-${idCard18.slice(10, 12)}-${idCard18.slice(12, 14)}<br>`;
        resultDiv.innerHTML += `性别：${parseInt(idCard18.charAt(16)) % 2 === 0 ? '女' : '男'}<br>`;

        // 校验身份证号有效性
        if (isValidIdCard(idCard18)) {
          resultDiv.innerHTML += `<span class="valid">该身份证号有效</span>`;
        } else {
          resultDiv.innerHTML += `<span class="invalid">该身份证号无效</span>`;
        }
      } else {
        resultDiv.innerHTML = '请输入有效的18位身份证号码';
      }
    }

    // 校验身份证号码是否有效
    function isValidIdCard(idCard) {
      const weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
      const verifyCode = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];

      let sum = 0;
      for (let i = 0; i < 17; i++) {
        sum += parseInt(idCard.charAt(i)) * weights[i];
      }
      const mod = sum % 11;
      const checkChar = verifyCode[mod];
      return idCard.charAt(17).toUpperCase() === checkChar;
    }

    // 15转18功能
    function convert15To18() {
      const idCard15 = document.getElementById('idCard15').value.trim();
      const yearPrefix = document.getElementById('yearOption').value;

      if (idCard15.length === 15) {
        const year = yearPrefix + idCard15.slice(6, 8);
        const monthDay = idCard15.slice(8, 12);
        const newIdCard18 = idCard15.slice(0, 6) + year + monthDay + generateCheckCode(idCard15.slice(0, 17) + year + monthDay);
        document.getElementById('result15').innerHTML = `转换后的18位身份证号码是：${newIdCard18}`;
      }
    }

    // 18转15功能
    function convert18To15() {
      const idCard18 = document.getElementById('idCard18To15').value.trim();

      if (idCard18.length === 18) {
        const newIdCard15 = idCard18.slice(0, 6) + idCard18.slice(8, 17);
        document.getElementById('result18To15').innerHTML = `转换后的15位身份证号码是：${newIdCard15}`;
      }
    }

    // 生成身份证号码的校验码
    function generateCheckCode(idCard) {
      const weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
      const verifyCode = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];

      let sum = 0;
      for (let i = 0; i < 17; i++) {
        sum += parseInt(idCard.charAt(i)) * weights[i];
      }
      const mod = sum % 11;
      return verifyCode[mod];
    }

    loadRegionData();
  </script>
</body>
</html>
